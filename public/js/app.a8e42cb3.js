(function(e){function t(t){for(var n,o,r=t[0],c=t[1],l=t[2],d=0,h=[];d<r.length;d++)o=r[d],i[o]&&h.push(i[o][0]),i[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(h.length)h.shift()();return a.push.apply(a,l||[]),s()}function s(){for(var e,t=0;t<a.length;t++){for(var s=a[t],n=!0,r=1;r<s.length;r++){var c=s[r];0!==i[c]&&(n=!1)}n&&(a.splice(t--,1),e=o(o.s=s[0]))}return e}var n={},i={app:0},a=[];function o(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=n,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(s,n,function(t){return e[t]}.bind(null,n));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var l=0;l<r.length;l++)t(r[l]);var u=c;a.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"010f":function(e,t,s){},1795:function(e,t,s){"use strict";var n=s("a4d6"),i=s.n(n);i.a},"2f86":function(e,t,s){"use strict";var n=s("7175"),i=s.n(n);i.a},"314d":function(e,t,s){},"33cd":function(e,t,s){},3494:function(e,t,s){"use strict";var n=s("8330"),i=s.n(n);i.a},"416a":function(e,t,s){"use strict";var n=s("7e91"),i=s.n(n);i.a},5002:function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);s("cadf"),s("551c"),s("f751"),s("097d");var n=s("2b0e"),i=s("2f62"),a=s("bd86"),o=s("795b"),r=s.n(o),c=s("cebc"),l=s("bc3a"),u=s.n(l),d={get:function(e,t,s){return u.a.get(e,Object(c["a"])({params:t},s)).then(function(e){return e.data})},post:function(e,t,s){return u.a.post(e,t,s).then(function(e){return e.data})},delete:function(e,t,s){return u.a.delete(e,Object(c["a"])({params:t},s)).then(function(e){return e.data})}};function h(){return d.get("/user").then(function(e){return e.user}).catch(function(e){return r.a.reject(e)})}function m(e){return d.post("/user",e).then(function(e){return e}).catch(function(e){return r.a.reject(e)})}function v(e){return d.post("/user/status",e).then(function(e){return e.status.status}).catch(function(e){return r.a.reject(e)})}function f(e){return d.post("/user/avatar",e).then(function(e){return e.avatar.avatar}).catch(function(e){return r.a.reject(e)})}function g(){return d.get("/user/friends").then(function(e){return e.friends}).catch(function(e){return r.a.reject(e)})}function p(e,t){return d.post("/user/login",{username:e,password:t}).then(function(e){return e}).catch(function(e){return r.a.reject(e)})}function b(){return d.post("/user/logout").then(function(e){return e}).catch(function(e){return r.a.reject(e)})}function C(e,t){return d.post("https://api.imgur.com/3/image",e,t).then(function(e){return e}).catch(function(e){return r.a.reject(e)})}function _(e){return d.post("/user/search",{username:e}).then(function(e){return e}).catch(function(e){return r.a.reject(e)})}var x,R,w="GET_USER",y="UPDATE_STATUS",k="UPDATE_AVATAR",O="UPDATE_FRIENDS",j="REMOVE_FRIEND_REQUEST",E="UPDATE_FRIEND_REQUEST",S="RESET_USER",T="GET_CHATROOMS",q="ADD_CHATROOM",A="SELECT_CHATROOM",M="UNSELECT_CHATROOM",I="DELETE_CHATROOM",N="START_CHATTING",F="STOP_CHATTING",$="SEND_MESSAGE",L="RECEIVE_NEW_MESSAGE",H="RECEIVE_NEW_MESSAGE_IN_OTHER_ROOM",V="HAS_UNREAD_MESSAGE",P="CONCAT_OLD_MESSAGES",D="HAS_ALL_MESSAGES",U="EMPTY_MESSAGES",B="RESET_CHATROOMS",G=!0,z={user:{}},J={friendsList:function(e){return e.user.friends},incomingFriendRequestsList:function(e){return e.user.incomingFriendRequests},sentFriendRequestsList:function(e){return e.user.sentFriendRequests}},Y={getUser:function(e){var t=e.commit;return h().then(function(e){return t(w,{user:e}),e})},updateStatus:function(e,t){var s=e.commit;return v(t).then(function(e){return s(y,{returnedStatus:e})})},updateAvatar:function(e,t){var s=e.commit;return f(t).then(function(e){return s(k,{returnedAvatar:e})})},getUpdatedFriends:function(e){var t=e.commit;return g().then(function(e){return t(O,{returnedFriends:e})})}},Q=(x={},Object(a["a"])(x,w,function(e,t){var s=t.user;e.user=s}),Object(a["a"])(x,y,function(e,t){var s=t.returnedStatus;e.user.status=s}),Object(a["a"])(x,k,function(e,t){var s=t.returnedAvatar;e.user.avatar=s}),Object(a["a"])(x,O,function(e,t){var s=t.returnedFriends;e.user.friends=s}),Object(a["a"])(x,E,function(e,t){var s=t.friendRequest;e.user.incomingFriendRequests=s||[]}),Object(a["a"])(x,j,function(e,t){var s=t.requestIndex;e.user.incomingFriendRequests.splice(s,1)}),Object(a["a"])(x,S,function(e){e.user={}}),x),X={namespaced:G,state:z,getters:J,actions:Y,mutations:Q};s("20d6");function W(){return d.get("/user/chat-rooms").then(function(e){return e.chatRooms}).catch(function(e){console.log(e)})}function Z(e){return d.delete("/user/chat-room/".concat(e)).then(function(e){return e.removedChatRoom}).catch(function(e){console.log(e)})}function K(e){return d.get("/user/old-messages?id=".concat(e.chatRoomId,"&hasMsg=").concat(e.numOfLocalMessages)).then(function(e){return e}).catch(function(e){console.log(e)})}var ee=!0,te={chatRooms:[],selectedChatRoom:{},isChatting:!1},se={messages:function(e){return e.selectedChatRoom.messages?e.selectedChatRoom.messages:[]},currentFriend:function(e){return e.selectedChatRoom.recipient?e.selectedChatRoom.recipient:{}}},ne={getChatRooms:function(e){var t=e.commit;return W().then(function(e){return t(T,{chatRooms:e})})},deleteChatRoomById:function(e,t){var s=e.commit;return Z(t).then(function(e){return s(I,{chatRoomId:e})})},checkoutOldMessages:function(e,t){var s=e.commit;return K(t).then(function(e){s(P,{chatRoomId:t.chatRoomId,oldMessages:e.oldMessages}),e.isLast&&s(D,{chatRoomId:t.chatRoomId,hasAllMsgs:e.isLast})})}},ie=(R={},Object(a["a"])(R,T,function(e,t){var s=t.chatRooms;e.chatRooms=s}),Object(a["a"])(R,q,function(e,t){var s=t.chatRoom;e.chatRooms.unshift(s)}),Object(a["a"])(R,A,function(e,t){for(var s=t.chatRoomId,n=0;n<e.chatRooms.length;n++)e.chatRooms[n]._id===s&&(e.selectedChatRoom=e.chatRooms[n]);e.selectedChatRoom.hasUnreadMessage&&(e.selectedChatRoom.hasUnreadMessage=!1)}),Object(a["a"])(R,M,function(e){e.selectedChatRoom={}}),Object(a["a"])(R,I,function(e,t){for(var s=t.chatRoomId,n=0;n<e.chatRooms.length;n++)if(e.chatRooms[n]._id===s){e.chatRooms.splice(n,1);break}}),Object(a["a"])(R,N,function(e){e.isChatting=!0}),Object(a["a"])(R,F,function(e){e.isChatting=!1}),Object(a["a"])(R,$,function(e,t){var s=t.message;e.selectedChatRoom.messages.push(s),ae(e.chatRooms,e.selectedChatRoom)}),Object(a["a"])(R,L,function(e,t){for(var s=t.message,n=0;n<e.chatRooms.length;n++)e.chatRooms[n].recipient._id===s.sender&&(e.chatRooms[n].messages.push(s),oe(e.chatRooms,e.chatRooms[n],n))}),Object(a["a"])(R,H,function(e,t){for(var s=t.message,n=0;n<e.chatRooms.length;n++)e.chatRooms[n].recipient._id===s.sender&&(e.chatRooms[n].messages.push(s),e.chatRooms[n].hasUnreadMessage=!0,oe(e.chatRooms,e.chatRooms[n],n))}),Object(a["a"])(R,V,function(e,t){for(var s=t.chatRoom,n=0;n<e.chatRooms.length;n++)e.chatRooms[n]._id===s._id&&(e.chatRooms[n].hasUnreadMessage=!0)}),Object(a["a"])(R,P,function(e,t){for(var s=t.chatRoomId,n=t.oldMessages,i=0;i<e.chatRooms.length;i++)e.chatRooms[i]._id===s&&(e.chatRooms[i].messages=n.concat(e.chatRooms[i].messages))}),Object(a["a"])(R,D,function(e,t){for(var s=t.chatRoomId,n=t.hasAllMsgs,i=0;i<e.chatRooms.length;i++)e.chatRooms[i]._id===s&&(e.chatRooms[i].hasAllMsgs=n)}),Object(a["a"])(R,U,function(e,t){for(var s=t.chatRoomId,n=0;n<e.chatRooms.length;n++)if(e.chatRooms[n]._id===s){e.chatRooms[n].messages=[],e.chatRooms[n].hasAllMsgs=!1;break}}),Object(a["a"])(R,B,function(e){e.chatRooms=[],e.selectedChatRoom={},e.isChatting=!1}),R);function ae(e,t){var s=e.findIndex(function(e){return e._id===t._id});s>0&&(e.splice(s,1),e.unshift(t))}function oe(e,t,s){s>0&&(e.splice(s,1),e.unshift(t))}var re={namespaced:ee,state:te,getters:se,actions:ne,mutations:ie};n["default"].use(i["a"]);var ce=new i["a"].Store({modules:{user:X,chatRoom:re}}),le=s("ce5b"),ue=s.n(le),de=s("7bb1"),he=(s("bf40"),s("5363"),s("d1e7"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("nav-bar"),s("main",[s("keep-alive",[e.$route.meta.keepAlive?s("router-view",{staticClass:"view grey lighten-3"}):e._e()],1),e.$route.meta.keepAlive?e._e():s("router-view",{staticClass:"view grey lighten-3"})],1)],1)}),me=[],ve=s("0a0d"),fe=s.n(ve);s("28a5"),s("4917"),s("3b2b");function ge(e){var t,s=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(s))?t[2]:null}function pe(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}var be=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-toolbar",{staticClass:"navbar",attrs:{flat:"",dense:""}},[n("v-toolbar-side-icon",{staticClass:"hidden-md-and-up"}),n("v-toolbar-title",[n("img",{staticClass:"logo",class:{"animated pulse":e.isHover},attrs:{src:s("cf05")},on:{mouseover:function(t){e.isHover=!0},mouseleave:function(t){e.isHover=!1}}})]),n("span",[e._v("BY Junlin Guo")]),n("v-spacer"),n("v-toolbar-items",{staticClass:"hidden-sm-and-down"},[e.user.username?[n("v-btn",{attrs:{color:"primary",flat:"",to:"/chatroom"}},[n("v-avatar",{staticClass:"grey lighten-4 mr-1",attrs:{size:"30px"}},[n("img",{attrs:{src:e.user.avatar,alt:"avatar"}})]),e._v(e._s(e.user.username))],1),n("v-btn",{attrs:{flat:""},on:{click:function(t){e.showAbout=!0}}},[e._v("About")]),n("v-btn",{attrs:{flat:""},on:{click:function(t){e.showContact=!0}}},[e._v("Contact")])]:[n("v-btn",{attrs:{color:"primary",flat:"",to:"/",exact:""}},[e._v("注册")]),n("v-btn",{attrs:{color:"primary",flat:"",to:"/login"}},[e._v("登录")])]],2),e.showAbout?n("vue-dialog",{attrs:{dialogName:"about"}},[n("template",{slot:"title"},[e._v("关于纯聊")]),n("template",{slot:"content"},[e._v("\n        “纯聊”是我一次自我的实践。主要目的是在学习了技术以后给自己一个机会能施展技术，不然就是纸上谈兵了。"),n("br"),n("hr"),e._v("\n        即时聊天的实现并不难，寥寥几行代码一切都为你准备完毕。所以这个项目对我来说，难点主要出在: "),n("br"),e._v("1.操作数据库 "),n("br"),e._v("2.前端获取和展示聊天记录的逻辑。"),n("br"),e._v("\n        所以在开发过程中遇到这两个方面的问题我固执地自己想自己的笨办法，目的也只是希望能练习大脑。"),n("br"),n("hr"),e._v("如果你在使用“纯聊”，谢谢你能容忍一个不会设计的前端搞出来的界面~遇到bug拜托拜托请告诉我！！！！！！！旁边的链接里有我的联系方式！！！！！\n    ")])],2):e._e(),e.showContact?n("vue-dialog",{attrs:{dialogName:"contact"}},[n("template",{slot:"title"},[e._v("联系我")]),n("template",{slot:"content"},[n("v-icon",{staticClass:"grey--text text--lighten-1 mr-2"},[e._v("mdi-email")]),n("span",[e._v("junlin.guo11@gmail.com")]),n("br"),n("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"input",label:"拜托告诉我bug~~，谢谢~",textarea:"",required:""},model:{value:e.report,callback:function(t){e.report=t},expression:"report"}}),n("v-btn",{attrs:{color:"primary",loading:e.loading,disabled:e.loading},on:{click:e.sendReport}},[e._v("发送")])],1)],2):e._e()],1)},Ce=[];function _e(e){return d.post("/report",{content:e}).then(function(e){return e.data}).catch(function(e){return r.a.reject(e)})}var xe=new n["default"],Re=xe,we=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-dialog",{attrs:{persistent:""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[s("v-card",[s("v-card-title",{staticClass:"headline"},[e._t("title")],2),s("v-card-text",[e._t("content")],2),s("v-card-actions",[s("v-spacer"),s("v-btn",{staticClass:"green--text darken-1",attrs:{flat:"flat"},nativeOn:{click:function(t){return e.close(t)}}},[e._v("关闭")])],1)],1)],1)},ye=[],ke={name:"dialog",props:["dialogName"],data:function(){return{show:!0}},methods:{close:function(){Re.$emit("closeDialog",this.dialogName)}}},Oe=ke,je=s("2877"),Ee=Object(je["a"])(Oe,we,ye,!1,null,null,null),Se=Ee.exports,Te={name:"navbar",components:{VueDialog:Se},data:function(){return{title:"Chat App",showAbout:!1,showContact:!1,isHover:!1,report:"",loading:!1}},computed:Object(c["a"])({},Object(i["e"])("user",["user"])),methods:{sendReport:function(){var e=this;this.$validator.validateAll().then(function(t){t&&(e.loading=!0,_e(e.report).then(function(){e.loading=!1,e.report=""}))})}},created:function(){var e=this;Re.$on("closeDialog",function(t){"about"===t?e.showAbout=!1:e.showContact=!1})}},qe=Te,Ae=(s("416a"),Object(je["a"])(qe,be,Ce,!1,null,"0f73a032",null)),Me=Ae.exports,Ie={name:"app",components:{NavBar:Me},methods:Object(c["a"])({isLoggedIn:function(){var e=ge("awesome");if(e){var t=e.split(".")[1];return t=window.atob(t),t=decodeURIComponent(t),t=JSON.parse(t),t.exp>fe()()/1e3}return!1},checkLogin:function(){var e=this;this.isLoggedIn()&&this.getUser().then(function(t){e.$socket.emit("online",t._id),document.title="纯聊|".concat(t.username),e.getChatRooms()}).then(function(){"/chatroom"!==e.$router.path&&e.$router.push("/chatroom")})}},Object(i["b"])("user",["getUser"]),Object(i["b"])("chatRoom",["getChatRooms"])),watch:{$route:"checkLogin"},mounted:function(){this.checkLogin()}},Ne=Ie,Fe=(s("3494"),Object(je["a"])(Ne,he,me,!1,null,"4b5ecf35",null)),$e=Fe.exports,Le=s("8c4f"),He=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-app",[s("v-layout",[s("v-flex",{attrs:{xs12:"",sm6:"","offset-sm3":"",lg6:"","offset-lg3":""}},[s("v-card",{staticClass:"mt-4"},[s("v-img",{staticClass:"white--text",attrs:{height:"200px",src:"https://i.imgur.com/kDpdmiL.jpg"}}),s("register-form")],1)],1)],1)],1)},Ve=[],Pe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",{attrs:{"grid-list-xl":""}},[s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",[s("form",[s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs12:"",sm12:"",lg6:""}},[s("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|min:3|uniqueName",expression:"'required|min:3|uniqueName'"}],attrs:{label:"用户名","error-messages":e.errors.collect("用户名"),"data-vv-name":"用户名","append-icon":e.username&&e.nameValid?"mdi-checkbox-marked-circle":"",required:""},on:{keyup:e.onTypeName},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}})],1),s("v-flex",{attrs:{xs12:"",sm12:"",lg6:""}},[s("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{items:e.genders,label:"性别","error-messages":e.errors.collect("性别"),"data-vv-name":"性别","item-value":"text",required:""},model:{value:e.gender,callback:function(t){e.gender=t},expression:"gender"}})],1),s("v-flex",{attrs:{xs12:"",sm12:"",lg6:""}},[s("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|email|uniqueEmail",expression:"'required|email|uniqueEmail'"}],attrs:{label:"E-mail","error-messages":e.errors.collect("email"),"data-vv-name":"email","append-icon":e.email&&e.emailValid?"mdi-checkbox-marked-circle":"",required:""},on:{keyup:e.onTypeEmail},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}})],1),s("v-flex",{attrs:{xs12:"",sm12:"",lg6:""}},[s("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"mobile",expression:"'mobile'"}],attrs:{label:"手机","error-messages":e.errors.collect("手机"),"data-vv-name":"手机","data-vv-delay":"1200"},model:{value:e.mobile,callback:function(t){e.mobile=t},expression:"mobile"}})],1),s("v-flex",{attrs:{xs12:"",sm12:"",lg6:""}},[s("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required|password|min:8",expression:"'required|password|min:8'"}],ref:"password",attrs:{label:"密码","append-icon":e.visible?"visibility":"visibility_off",type:e.visible?"password":"text","error-messages":e.errors.collect("密码"),name:"password","data-vv-name":"密码",required:""},on:{"click:append":function(){return e.visible=!e.visible}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),s("v-flex",{attrs:{xs12:"",sm12:"",lg6:""}},[s("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"confirmed:password|required|password|min:8",expression:"'confirmed:password|required|password|min:8'"}],attrs:{label:"确认密码","append-icon":e.visible2?"visibility":"visibility_off",type:e.visible2?"password":"text","error-messages":e.errors.collect("确认密码"),name:"confirm-password","data-vv-name":"确认密码",required:""},on:{"click:append":function(){return e.visible2=!e.visible2}},model:{value:e.confirmPassword,callback:function(t){e.confirmPassword=t},expression:"confirmPassword"}})],1),s("v-flex",{directives:[{name:"show",rawName:"v-show",value:e.hasResponse,expression:"hasResponse"}],attrs:{xs12:"",lg12:""}},[s("alert-bar",{attrs:{"has-response":e.hasResponse,"is-success":e.isSuccess}},[e.isSuccess?s("div",[e._v("\n                                您已注册成功，"),s("router-link",{attrs:{to:"/login"}},[e._v("点此登录")])],1):e.message?s("div",[e._v("\n                                "+e._s(e.message)+"\n                            ")]):s("div",[e._v("\n                                遇到了一些问题，请尝试重新注册\n                            ")])])],1),s("v-flex",[s("vue-recaptcha",{ref:"recaptcha",attrs:{sitekey:"6Lfp0zEUAAAAAH_Of9Aqy6QgALXBVi3oibUgDwbv"},on:{verify:e.onVerify}})],1)],1),s("v-btn",{attrs:{loading:e.loading,disabled:e.loading},on:{click:e.submit}},[e._v("提交")]),s("v-btn",{on:{click:e.clear}},[e._v("清空")])],1)])],1)],1)},De=[];function Ue(e){return d.post("/unique-name",{username:e}).then(function(e){return e}).catch(function(e){console.log(e)})}function Be(e){return d.post("/unique-email",{email:e}).then(function(e){return e}).catch(function(e){console.log(e)})}var Ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-alert",{staticClass:"alert",attrs:{color:e.isSuccess?"success":"warning",icon:e.isSuccess?"check_circle":"warning",value:e.hasResponse,transition:"scale-transition",dismissible:""},model:{value:e.hasResponse,callback:function(t){e.hasResponse=t},expression:"hasResponse"}},[e._t("default")],2)},ze=[],Je={props:{isSuccess:{type:Boolean,required:!0},hasResponse:{type:Boolean,required:!0}},data:function(){return{visible:!0}}},Ye=Je,Qe=(s("ef68"),Object(je["a"])(Ye,Ge,ze,!1,null,"6b8777ce",null)),Xe=Qe.exports,We=s("e096"),Ze={name:"registerForm",components:{AlertBar:Xe,VueRecaptcha:We["a"]},data:function(){return{username:"",email:"",nameValid:!1,emailValid:!1,genders:[{text:"男"},{text:"女"}],gender:"",mobile:"",visible:!0,visible2:!0,password:"",confirmPassword:"",recaptchaVisible:!0,recaptchaResponse:"",message:"",hasResponse:!1,isSuccess:!1,loading:!1,errorBag:{}}},methods:{onVerify:function(e){this.recaptchaResponse=e},onTypeName:function(){this.errorBag.has("用户名")&&(this.nameValid=!1)},onTypeEmail:function(){this.errorBag.has("email")&&(this.emailValid=!1)},submit:function(){var e=this;this.$validator.validateAll().then(function(t){t&&(e.loading=!0,m({username:e.username,gender:e.gender,email:e.email,mobile:e.mobile,password:e.password,confirmPassword:e.confirmPassword,recaptchaResponse:e.recaptchaResponse}).then(function(t){e.hasResponse=!0,e.loading=!1,e.isSuccess=t.isSuccess,e.isSuccess&&e.clear(),e.$refs.recaptcha.reset(),t.message&&(e.message=t.message)}))})},clear:function(){this.username="",this.email="",this.gender=null,this.mobile="",this.password="",this.confirmPassword="",this.$validator.reset()}},created:function(){var e=this;this.errorBag=this.$validator.errors;var t=function(t){if(t.length>=3)return Ue(t).then(function(t){return e.nameValid=t.valid,{valid:t.valid,data:{message:t.message}}});e.nameValid=!1},s=function(t){return Be(t).then(function(t){return e.emailValid=t.valid,{valid:t.valid,data:{message:t.message}}})};de["a"].extend("mobile",{getMessage:function(e){return"手机格式不正确"},validate:function(e){var t=/^1[34578]\d{9}$/;return t.test(e)}}),de["a"].extend("password",{getMessage:function(e){return"密码需包含数字，大写字母，小写字母，至少8位"},validate:function(e){var t=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/;return t.test(e)}}),de["a"].extend("uniqueName",{validate:t,getMessage:function(e,t,s){return s.message}}),de["a"].extend("uniqueEmail",{validate:s,getMessage:function(e,t,s){return s.message}})}},Ke=Ze,et=Object(je["a"])(Ke,Pe,De,!1,null,null,null),tt=et.exports,st={name:"loginBase",components:{RegisterForm:tt}},nt=st,it=Object(je["a"])(nt,He,Ve,!1,null,null,null),at=it.exports,ot=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-app",[s("v-layout",[s("v-flex",{staticClass:"loginDiv",attrs:{xs12:"",sm4:"","offset-sm4":"",lg4:"","offset-lg4":""}},[s("v-card",{staticClass:"mt-4",attrs:{transition:"slide-x-reverse-transition",origin:"center center"}},[s("v-img",{staticClass:"white--text",attrs:{height:"240px",src:"https://i.imgur.com/0n2iJv8.jpg"}}),s("login-form")],1)],1)],1)],1)},rt=[],ct=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",{attrs:{"grid-list-xl":""}},[s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",[s("form",[s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs12:"",sm12:""}},[s("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{label:"用户名","error-messages":e.errors.collect("用户名"),name:"username","data-vv-name":"用户名",required:""},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}})],1),s("v-flex",{attrs:{xs12:"",sm12:""}},[s("v-text-field",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{label:"密码","append-icon":e.visible?"visibility":"visibility_off",type:e.visible?"password":"text","error-messages":e.errors.collect("密码"),name:"password","data-vv-name":"密码"},on:{"click:append":function(){return e.visible=!e.visible},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),s("v-flex",{attrs:{xs12:"",lg12:""}},[s("alert-bar",{attrs:{"has-response":e.hasReponse,"is-success":e.isSuccess},domProps:{innerHTML:e._s(e.hint)}})],1)],1),s("v-btn",{attrs:{loading:e.loading,disabled:e.loading},on:{click:e.submit}},[e._v("登录")]),s("v-btn",{attrs:{to:"/"}},[e._v("注册")])],1)])],1)],1)},lt=[],ut={name:"loginForm",components:{AlertBar:Xe},data:function(){return{username:"",password:"",visible:!0,hasReponse:!1,isSuccess:!1,message:"",loading:!1}},computed:{hint:function(){return this.isSuccess?"<i class='mdi mdi-checkbox-marked-circle mr-2'></i> 成功登录":"<i class='mdi mdi-alert-decagram mr-2'></i>".concat(this.message)}},methods:{submit:function(){var e=this;this.$validator.validateAll().then(function(t){t&&(e.loading=!0,window.Notification&&"granted"!==Notification.permission&&Notification.requestPermission(),p(e.username,e.password).then(function(t){e.loading=!1,e.hasReponse=!0,e.isSuccess=t.isSuccess,e.message=t.message,e.isSuccess&&e.$router.push("/chatroom")}))})},askNoticePerimission:function(){"Notification"in window?"denied"!==Notification.permission&&Notification.requestPermission():console.log("This browser does not support desktop notification")}}},dt=ut,ht=Object(je["a"])(dt,ct,lt,!1,null,null,null),mt=ht.exports,vt={name:"loginBase",components:{LoginForm:mt},data:function(){return{}},created:function(){document.title="纯聊|用户登录"}},ft=vt,gt=(s("e9bf"),Object(je["a"])(ft,ot,rt,!1,null,"a6c57d2a",null)),pt=gt.exports,bt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-app",{staticClass:"chat-room"},[s("v-layout",{attrs:{"align-start":""}},[s("v-layout",{staticClass:"vertical-bar"},[s("v-flex",[s("v-card",[s("vue-tabs",{staticClass:"tab1",attrs:{"active-tab-color":"#363e47","active-text-color":"white",type:"pills","start-index":1,direction:"vertical"},on:{"tab-change":e.handleTabChange}},[s("v-tab",{attrs:{icon:"mdi mdi-account"}},[s("profile",{attrs:{user:e.user}})],1),s("v-tab",{attrs:{icon:e.messageIcon}},[s("chat-room-list",{attrs:{user:e.user}})],1),s("v-tab",{attrs:{icon:"mdi mdi-account-multiple-plus"}},[s("friend-request",{attrs:{user:e.user}})],1),s("v-tab",{attrs:{icon:"mdi mdi-account-multiple"}},[s("friends-list",{attrs:{user:e.user}})],1),s("v-tab",{attrs:{icon:"mdi mdi-magnify"}},[s("search-friend",{attrs:{user:e.user}})],1)],1),s("div",{staticClass:"bottom-btn"},[s("v-btn",{staticClass:"pink--text logout-btn",attrs:{icon:""},on:{click:e.logout}},[s("v-icon",[e._v("mdi-power")])],1)],1)],1)],1)],1),s("chat-box",{on:{videoOffer:e.handleVideoCall,videoCall:e.handleVideoCall,video:e.handleVideo,receiveVideo:e.handleVideo}}),e.isActive?s("friend-profile"):e._e()],1),e.showVideoCard?s("video-card",{attrs:{request:e.videoRequest,response:e.videoResponse,srcObject:e.videoSrcObject}}):e._e(),s("v-snackbar",{attrs:{top:"",timeout:e.timeout,color:"primary"},model:{value:e.showHint,callback:function(t){e.showHint=t},expression:"showHint"}},[e._v("\n        "+e._s(e.newFriendRequestHint)+"\n        "),s("v-btn",{staticClass:"pink--text",attrs:{icon:""},nativeOn:{click:function(t){e.showHint=!1}}},[s("v-icon",[e._v("mdi-close")])],1)],1)],1)},Ct=[],_t=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-layout",{staticClass:"profile"},[s("v-flex",{attrs:{xs12:""}},[s("v-container",{staticClass:"pl-0 pr-0 pb-0 profile-container"},[s("v-layout",[s("v-flex",{attrs:{"text-xs-center":""}},[s("div",{staticClass:"avatarDiv"},[s("v-avatar",{attrs:{size:"20vmin"}},[s("img",{attrs:{src:e.user.avatar,alt:"avatar"}})]),s("v-btn",{staticClass:"uploadBtn indigo--text",attrs:{color:"primary",fab:"",ripple:"",small:"",dark:"",top:"",right:"",absolute:"",loading:e.loading,disabled:e.loading}},[s("v-icon",{staticClass:"edit-icon"},[e._v("edit")]),s("input",{attrs:{type:"file",id:"fileInput",name:"fileInput",accept:"image/*"},on:{change:e.fileSelected}})],1)],1),s("div",{staticClass:"username grey--text text--lighten-4"},[e._v("\n                            "+e._s(e.user.username)+"\n                            "),"男"===e.user.gender?s("v-icon",{staticClass:"blue--text"},[e._v("mdi-gender-male")]):s("v-icon",{staticClass:"pink--text"},[e._v("mdi-gender-female")])],1)])],1),s("v-layout",{staticClass:"grey--text text--lighten-1"},[s("v-flex",{attrs:{xs10:"","offset-xs1":""}},[s("div",{staticClass:"user-info mt-3"},[s("div",[s("v-icon",{staticClass:"grey--text text--lighten-1"},[e._v("mdi-email")]),s("span",[e._v(e._s(e.user.email))])],1),s("div",[s("v-icon",{staticClass:"grey--text text--lighten-1"},[e._v("mdi-cellphone-iphone")]),s("span",[e._v(e._s(e.user.mobile))])],1),s("div",[s("v-icon",{staticClass:"grey--text text--lighten-1"},[e._v("mdi-lead-pencil")]),e.isEditing?e._e():s("div",{class:{"animated tada":e.isHover},attrs:{id:"status"},on:{click:e.editStatus,mouseover:function(t){e.isHover=!0},mouseleave:function(t){e.isHover=!1}}},[e._v(e._s(e.user.status?e.user.status:'"编辑一句话说说自己的想法"'))]),e.isEditing?s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.user.status,expression:"user.status"}],ref:"textarea",staticClass:"status-textarea",attrs:{maxlength:"35"},domProps:{value:e.user.status},on:{blur:e.onBlur,input:function(t){t.target.composing||e.$set(e.user,"status",t.target.value)}}}):e._e()],1)])])],1)],1),s("v-snackbar",{attrs:{top:"",timeout:e.timeout},model:{value:e.hasError,callback:function(t){e.hasError=t},expression:"hasError"}},[e._v("\n                "+e._s(e.errorMsg)+"\n                "),s("v-btn",{staticClass:"pink--text",attrs:{flat:""},nativeOn:{click:function(t){e.hasError=!1}}},[e._v("Close")])],1)],1)],1)},xt=[],Rt=(s("b54a"),{name:"profile",data:function(){return{loading:!1,hasError:!1,errorMsg:"",timeout:6e3,isHover:!1,isEditing:!1}},computed:Object(c["a"])({},Object(i["e"])("user",["user"])),methods:Object(c["a"])({fileSelected:function(e){var t=this;this.loading=!0;var s=e.target.files[0],n={authorization:"Client-ID 0255e84e0729357"};s&&C(s,{headers:n}).then(function(e){t.updateAvatar({avatar:e.data.link})}).then(function(){return t.loading=!1}).catch(function(){t.hasError=!0,t.loading=!1,t.errorMsg="有点小问题，请再试一次"})},editStatus:function(){this.isEditing=!0,this.$nextTick(function(){this.$refs.textarea.focus()})},onBlur:function(){var e=this,t={status:this.user.status.trim()};this.updateStatus(t).then(function(){e.isEditing=!1})}},Object(i["b"])("user",["updateStatus","updateAvatar"]))}),wt=Rt,yt=(s("1795"),Object(je["a"])(wt,_t,xt,!1,null,"ce014c0e",null)),kt=yt.exports,Ot=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("tab-container",[s("v-list",{staticClass:"list",attrs:{"two-line":""}},[s("v-subheader",{staticClass:"grey--text text--lighten-4"},[e._v("Chats")]),e._l(e.chatRooms,function(t,n){return[s("v-list-tile",{key:t._id,class:{"blue-grey darken-2":e.isCurrentChat(t._id)},attrs:{avatar:""},on:{click:function(s){return e.startChat(t._id)},contextmenu:function(s){return e.show(s,t._id,n)}}},[s("v-list-tile-avatar",[s("img",{attrs:{src:t.recipient.avatar}})]),s("v-list-tile-content",{staticClass:"grey--text text--lighten-4"},[s("v-list-tile-title",{domProps:{textContent:e._s(t.recipient.username)}}),s("v-list-tile-sub-title",{domProps:{textContent:e._s(e.getLastestMessage(t))}})],1),e.isCurrentChat(t._id)?e._e():s("v-list-tile-action",[t.hasUnreadMessage?s("v-icon",{class:{"green--text":t.hasUnreadMessage}},[e._v("mdi-message-text")]):e._e()],1)],1),n!=t.length-1?s("v-divider",{key:n,attrs:{inset:""}}):e._e()]})],2),s("v-menu",{staticClass:"right-click",attrs:{"offset-y":"","position-x":e.x,"position-y":e.y},model:{value:e.showMenu,callback:function(t){e.showMenu=t},expression:"showMenu"}},[s("v-list",[s("v-list-tile",{on:{click:e.deleteChatRoom}},[s("v-list-tile-title",[e._v("删除")])],1)],1)],1)],1)},jt=[],Et=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",{staticClass:"tab-container"},[s("v-layout",{staticClass:"tab-layout"},[s("v-flex",{attrs:{xs12:""}},[e._t("default")],2)],1)],1)},St=[],Tt=(s("a900"),{}),qt=Object(je["a"])(Tt,Et,St,!1,null,"3238a19d",null),At=qt.exports,Mt={name:"chatlist",components:{TabContainer:At},data:function(){return{showMenu:!1,x:0,y:0,chatRoomToDelete:{},chatRoomToDeleteIndex:0,titleTimer:0,title:"收到新消息~",text:"收到新消息~"}},computed:Object(c["a"])({},Object(i["e"])("user",["user"]),Object(i["e"])("chatRoom",["chatRooms","selectedChatRoom"])),methods:Object(c["a"])({show:function(e,t,s){var n=this;e.preventDefault(),this.x=e.clientX,this.y=e.clientY,this.$nextTick(function(){n.showMenu=!0}),this.chatRoomToDelete=t,this.chatRoomToDeleteIndex=s},startChat:function(e){this.selectChatRoom({chatRoomId:e}),this.startChatting(),window.clearTimeout(this.titleTimer),document.title="纯聊|".concat(this.user.username)},isCurrentChat:function(e){return this.selectedChatRoom._id===e},deleteChatRoom:function(){var e=this;this.chatRoomToDelete&&this.deleteChatRoomById(this.chatRoomToDelete).then(function(){e.chatRoomToDelete===e.selectedChatRoom._id&&(e.unselectChatRoom(),e.stopChatting())})},hasChatRoom:function(e){for(var t=!1,s=0;s<this.chatRooms.length;s++)if(this.chatRooms[s]._id===e._id){t=!0;break}return t},getLocalChatRoom:function(e){for(var t=0;t<this.chatRooms.length;t++)if(this.chatRooms[t]._id===e._id)return this.chatRooms[t]._id},getLastestMessage:function(e){if(e.messages.length>0)return e.messages[e.messages.length-1].body},titleNotice:function(){this.title=this.text.substring(1,this.text.length)+this.text.substring(0,1),this.text=this.title.substring(0,this.text.length),document.title="纯聊|".concat(this.title),this.titleTimer=window.setTimeout(this.titleNotice,400)},desktopNotice:function(e,t,s){if("Notification"in window)if("granted"===Notification.permission)new Notification(e,{icon:t,body:s});else"denied"!==Notification.permission&&Notification.requestPermission(function(e){if("granted"===e)new Notification("Hi there!")});else console.log("This browser does not support desktop notification")},sendDesktopNotice:function(e){for(var t=0;t<this.chatRooms.length;t++)if(e.sender===this.chatRooms[t].recipient._id){this.desktopNotice(this.chatRooms[t].recipient.username,this.chatRooms[t].recipient.avatar,e.body);break}}},Object(i["d"])("chatRoom",{addChatRoom:q,selectChatRoom:A,unselectChatRoom:M,startChatting:N,stopChatting:F,receiveNewMessage:L,receiveNewMessageInOtherRoom:H,hasUnreadMessage:V}),Object(i["b"])("chatRoom",["deleteChatRoomById"])),sockets:{startChat:function(e){this.hasChatRoom(e)?this.selectChatRoom({chatRoomId:this.getLocalChatRoom(e)}):(this.addChatRoom({chatRoom:e}),this.selectChatRoom({chatRoomId:e._id})),this.startChatting(),window.clearTimeout(this.titleTimer),document.title="纯聊|".concat(this.user.username)},messageInNewChatRoom:function(e){this.hasChatRoom(e)||(this.addChatRoom({chatRoom:e}),this.hasUnreadMessage({chatRoom:e}),this.titleNotice(),this.sendDesktopNotice(e.messages[0]))},message:function(e){this.selectedChatRoom.recipient?this.selectedChatRoom.recipient._id===e.sender?this.receiveNewMessage({message:e}):this.receiveNewMessageInOtherRoom({message:e}):(this.receiveNewMessageInOtherRoom({message:e}),this.titleNotice(),this.sendDesktopNotice(e))}}},It=Mt,Nt=(s("9917"),Object(je["a"])(It,Ot,jt,!1,null,"17c74d9a",null)),Ft=Nt.exports,$t=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-app",{staticClass:"chat-box"},[s("v-card",{staticClass:"white chat-box-inner",attrs:{flat:"",tile:""}},[s("v-card",{staticClass:"grey lighten-4 ",attrs:{flat:"",tile:""}},[s("v-card-text",{directives:[{name:"chat-scroll",rawName:"v-chat-scroll",value:{always:!1},expression:"{always: false}"},{name:"scroll",rawName:"v-scroll",value:{target:".message-box",callback:this.onScrollTop},expression:"{\n                target: '.message-box',\n                callback: this.onScrollTop\n            }"}],staticClass:"message-box",on:{contextmenu:function(t){e.isActive&&e.show(t)}}},[s("v-container",[s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs12:""}},[s("v-progress-circular",{directives:[{name:"show",rawName:"v-show",value:e.checkoutOldMsgs,expression:"checkoutOldMsgs"}],attrs:{indeterminate:"",size:20,color:"primary"}}),e._l(e.messages,function(t){return s("div",{key:t._id,class:e.alignment(t)},[t.sender!==e.user._id?s("v-avatar",{staticClass:"grey lighten-4 mr-1",attrs:{size:"50px"}},[s("img",{attrs:{src:e.friend.avatar,alt:"avatar"}})]):e._e(),s("div",{class:e.bubbleAlignment(t)},[s("div",{staticClass:"text"},[s("div",[e._v(e._s(t.body))])])]),t.sender===e.user._id?s("v-avatar",{staticClass:"grey lighten-4 ml-1",attrs:{size:"50px"}},[s("img",{attrs:{src:e.user.avatar,alt:"avatar"}})]):e._e()],1)}),e.friend.avatar&&e.friendIsTyping?s("div",{staticClass:"text-xs-left friend-msg"},[s("v-avatar",{staticClass:"grey lighten-4 mr-1",attrs:{size:"50px"}},[s("img",{attrs:{src:e.friend.avatar,alt:"avatar"}})]),s("div",{staticClass:"bubble-left-typing"},[s("div",{staticClass:"text"},[s("div",{staticClass:"spinner"},[s("div",{staticClass:"bounce1"}),s("div",{staticClass:"bounce2"}),s("div",{staticClass:"bounce3"})])])])],1):e._e()],2)],1)],1),s("v-menu",{staticClass:"right-click",attrs:{"offset-y":"","position-x":e.x,"position-y":e.y},model:{value:e.showMenu,callback:function(t){e.showMenu=t},expression:"showMenu"}},[s("v-list",[s("v-list-tile",{on:{click:e.deleteMessages}},[s("v-list-tile-title",[e._v("清空")])],1)],1)],1)],1)],1),s("v-container",{directives:[{name:"on-clickaway",rawName:"v-on-clickaway",value:e.onClickAway,expression:"onClickAway"}]},[s("transition",{attrs:{name:"fade"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.isSelecting,expression:"isSelecting"}],attrs:{id:"emoji-panel-container"}})]),s("v-layout",{staticClass:"input-div",attrs:{fluid:"","justify-center":"","align-center":""}},[s("v-flex",{attrs:{xs12:""}},[s("div",{staticClass:"input-inner-div"},[s("v-icon",{class:{"emoji-is-active":e.isActive},on:{click:e.onOpenEmojiPanel}},[e._v("mdi-emoticon-happy")]),s("v-icon",{on:{click:e.onVideo}},[e._v("mdi-video")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.chat,expression:"chat"}],staticClass:"chat-input",attrs:{type:"text",placeholder:e.placeholder,disabled:!e.isActive},domProps:{value:e.chat},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSend(t)},keydown:e.onType,input:function(t){t.target.composing||(e.chat=t.target.value)}}}),s("v-icon",{class:{"send-btn-is-active":e.isActive},on:{click:e.onSend}},[e._v("mdi-send")])],1)])],1)],1)],1)],1)},Lt=[],Ht=(s("ac6a"),s("08d2")),Vt=s.n(Ht),Pt=(s("96cf"),s("3b8d")),Dt=s("7361"),Ut=s.n(Dt),Bt=s("edbf"),Gt=s.n(Bt),zt=s("c7db"),Jt={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},Yt={name:"chatbox",mixins:[zt["mixin"]],data:function(){return{showMenu:!1,x:0,y:0,messageContainer:{},isTyping:!1,typingTimeout:0,friendIsTyping:!1,chatRoom:{},chat:"",messageToBeSent:{},isSelecting:!1,emoji:{},checkoutOldMsgs:!1,videoRequest:null,videoConnection:null,mediaConstraints:{audio:!0,video:!0},negotiating:!1}},computed:Object(c["a"])({placeholder:function(){return this.isActive?"说点什么吧...":"选择一个朋友开始聊天..."}},Object(i["e"])("user",["user"]),Object(i["e"])("chatRoom",{selectedChatRoom:"selectedChatRoom",isActive:"isChatting"}),Object(i["c"])("chatRoom",{messages:"messages",friend:"currentFriend"})),created:function(){Re.$on("hangup",this.closeVideoCall)},methods:Object(c["a"])({show:function(e){var t=this;e.preventDefault(),this.showMenu=!1,this.x=e.clientX,this.y=e.clientY,this.$nextTick(function(){t.showMenu=!0})},onScrollTop:function(){var e=Object(Pt["a"])(regeneratorRuntime.mark(function e(t){var s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(0!==t.target.scrollTop||this.selectedChatRoom.hasAllMsg||!(this.selectedChatRoom.messages.length>=15)){e.next=8;break}if(!this.selectedChatRoom._id||this.selectedChatRoom.hasAllMsgs){e.next=8;break}return this.checkoutOldMsgs=!0,s=this.messageContainer.scrollHeight,e.next=6,this.checkoutOldMessages({chatRoomId:this.selectedChatRoom._id,numOfLocalMessages:this.selectedChatRoom.messages.length});case 6:this.checkoutOldMsgs=!1,this.messageContainer.scrollTop=this.messageContainer.scrollHeight-s;case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),onType:function(e){var t=this;"Enter"!==e.key&&(this.isTyping=!0,this.$socket.emit("typing",this.user._id,this.friend._id,this.isTyping),clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout(function(){t.isTyping=!1,t.$socket.emit("typing",t.user._id,t.friend._id,t.isTyping)},1e3))},onOpenEmojiPanel:function(){this.isActive&&(this.isSelecting=!this.isSelecting)},onSelectEmoji:function(e){e.unified.length>5?(this.chat+=this.emoji.replace_unified(Vt()("0x"+e.unified.substring(0,5))),this.chat+=this.emoji.replace_unified(Vt()("0x"+e.unified.substring(6)))):this.chat+=this.emoji.replace_unified(Vt()("0x"+e.unified))},onClickAway:function(){this.isSelecting=!1},onVideo:function(){if(this.isActive)return this.videoConnection?void console.log("正在视频"):(console.log("onVideo"),this.createPeerConnection(),this.createVideoOffer(),this.$emit("videoCall",{receiver:this.friend}))},onSend:function(){this.isActive&&this.chat&&(this.messageToBeSent={sender:this.user._id,receiver:this.friend._id,body:this.chat},this.$socket.emit("message",this.messageToBeSent),this.sendMessage({message:this.messageToBeSent}),this.clear(),this.isSelecting=!1)},clear:function(){this.chat="",this.messageToBeSent={}},alignment:function(e){return e.sender===this.user._id?"text-xs-right self-msg":"text-xs-left friend-msg"},bubbleAlignment:function(e){return e.sender===this.user._id?"bubble-right":"男"===this.friend.gender?"bubble-left-male":"bubble-left-female"},deleteMessages:function(){this.emptyMessages({chatRoomId:this.selectedChatRoom._id})},createPeerConnection:function(){var e;this.videoConnection=new RTCPeerConnection(Jt),e=void 0!==this.videoConnection.addTrack,this.videoConnection.onicecandidate=this.handleICECandidateEvent,this.videoConnection.onremovestream=this.handleRemoveStreamEvent,this.videoConnection.oniceconnectionstatechange=this.handleICEConnectionStateChangeEvent,this.videoConnection.onicegatheringstatechange=this.handleICEGatheringStateChangeEvent,this.videoConnection.onsignalingstatechange=this.handleSignalingStateChangeEvent,this.videoConnection.onnegotiationneeded=this.handleNegotiationNeededEvent,e?this.videoConnection.ontrack=this.handleTrackEvent:this.videoConnection.onaddstream=this.handleAddStreamEvent},closeVideoCall:function(){this.videoConnection&&(this.videoConnection.ontrack=null,this.videoConnection.onremovetrack=null,this.videoConnection.onremovestream=null,this.videoConnection.onicecandidate=null,this.videoConnection.oniceconnectionstatechange=null,this.videoConnection.onsignalingstatechange=null,this.videoConnection.onicegatheringstatechange=null,this.videoConnection.onnegotiationneeded=null,this.videoConnection.close(),this.videoConnection=null)},handleICECandidateEvent:function(e){e.candidate&&this.$socket.emit("iceCandidate",{sender:this.user._id,receiver:this.friend._id,candidate:e.candidate})},handleRemoveStreamEvent:function(){},handleICEConnectionStateChangeEvent:function(){switch(this.videoConnection.iceConnectionState){case"closed":case"failed":case"disconnected":this.closeVideoCall();break}},handleICEGatheringStateChangeEvent:function(){},handleSignalingStateChangeEvent:function(){switch(this.videoConnection.iceConnectionState){case"closed":this.closeVideoCall();break}},handleNegotiationNeededEvent:function(){console.log("negotiationNeeded"),this.videoConnection.signalingState},handleTrackEvent:function(e){this.$emit("receiveVideo",e.streams[0])},handleAddStreamEvent:function(){},createVideoOffer:function(){var e=this;this.videoConnection.createOffer().then(function(t){return e.videoConnection.setLocalDescription(t)}).then(function(){e.$socket.emit("videoOffer",{sender:e.user._id,receiver:e.friend._id,sdp:e.videoConnection.localDescription})})}},Object(i["b"])("chatRoom",["checkoutOldMessages"]),Object(i["d"])("chatRoom",{sendMessage:$,emptyMessages:U})),sockets:{message:function(){this.friendIsTyping=!1},typing:function(e){this.selectedChatRoom.recipient&&this.selectedChatRoom.recipient._id===e.uid&&(this.friendIsTyping=e.isTyping,this.messageContainer.scrollTop=this.messageContainer.scrollHeight)},videoOffer:function(e){return console.log("videoOffer"),this.$emit("videoOffer",e)},videoAnswer:function(e){console.log("videoAnswer");var t=new RTCSessionDescription(e.sdp);this.videoConnection.setRemoteDescription(t).catch(function(e){console.log(e)})},iceCandidate:function(e){console.log("iceCandidate",e);var t=new RTCIceCandidate(e.candidate);this.videoConnection.addIceCandidate(t).catch(function(e){console.log(e)})}},mounted:function(){this.messageContainer=this.$el.querySelector(".message-box"),new Ut.a(this.$el.querySelector("#emoji-panel-container"),{onClick:this.onSelectEmoji}),this.emoji=new Gt.a,this.emoji.replace_mode="unified"},updated:function(){this.chatRoom._id!==this.selectedChatRoom._id&&(this.messageContainer.scrollTop=this.messageContainer.scrollHeight,this.chatRoom=this.selectedChatRoom),this.friendIsTyping&&(this.messageContainer.scrollTop=this.messageContainer.scrollHeight)}},Qt=Yt,Xt=(s("77e6"),Object(je["a"])(Qt,$t,Lt,!1,null,"c1736fa0",null)),Wt=Xt.exports,Zt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("tab-container",[s("v-list",{staticClass:"friend-list",attrs:{"two-line":""}},[s("v-subheader",{staticClass:"grey--text text--lighten-4"},[e._v("Friends")]),e._l(e.friendsList,function(t,n){return[s("v-list-tile",{key:t.username,class:{"blue-grey darken-2":e.isSelectedFriend(t)},attrs:{avatar:""},on:{click:function(s){return e.startChat(t)}}},[s("v-list-tile-avatar",[s("img",{attrs:{src:t.avatar}})]),s("v-list-tile-content",{staticClass:"grey--text text--lighten-4"},[s("v-list-tile-title",{domProps:{innerHTML:e._s(t.username)}}),s("v-list-tile-sub-title",{domProps:{innerHTML:e._s(t.status)}})],1),e.isSelectedFriend(t)?e._e():s("v-list-tile-action",[s("v-icon",{staticClass:"grey--text text--lighten-4"},[e._v("mdi-message-plus")])],1)],1),n!=e.friendsList.length-1?s("v-divider",{key:t.username,attrs:{inset:""}}):e._e()]})],2)],1)},Kt=[],es={name:"friendlist",components:{TabContainer:At},data:function(){return{selectedFriend:{},chatIsStarted:!1}},computed:Object(c["a"])({},Object(i["e"])("user",["user"]),Object(i["c"])("user",["friendsList"])),methods:Object(c["a"])({isSelectedFriend:function(e){return this.selectedFriend._id===e._id},startChat:function(e){this.selectedFriend=e,this.$socket.emit("startChat",this.user._id,e._id)}},Object(i["b"])("user",["getUpdatedFriends"]),Object(i["d"])("user",{getFriends:O})),sockets:{addFriend:function(e){e.updatedFriendsList.friends.length>0&&this.getUpdatedFriends({friends:e.updatedFriendsList.friends})},agreeAddFriend:function(e){e.friendUpdatedFriendsList.friends.length>0&&this.getUpdatedFriends({friends:e.friendUpdatedFriendsList.friends})}}},ts=es,ss=(s("e569"),Object(je["a"])(ts,Zt,Kt,!1,null,"49864610",null)),ns=ss.exports,is=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("tab-container",[s("v-list",{staticClass:"friend-list",attrs:{"two-line":""}},[s("v-subheader",{staticClass:"grey--text text--lighten-4"},[e._v("Search Friends")]),s("v-flex",{staticClass:"search-box-div",attrs:{xs12:""}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.keyword,expression:"keyword"}],staticClass:"search-box grey--text text--lighten-4",attrs:{type:"text",placeholder:"搜索朋友"},domProps:{value:e.keyword},on:{input:[function(t){t.target.composing||(e.keyword=t.target.value)},e.searchFriend]}})]),e._l(e.results,function(t,n){return[s("v-list-tile",{key:t.username,attrs:{avatar:""}},[s("v-list-tile-avatar",[s("img",{attrs:{src:t.avatar}})]),s("v-list-tile-content",{staticClass:"grey--text text--lighten-4"},[s("v-list-tile-title",[e._v(e._s(t.username))]),s("v-list-tile-sub-title",[e._v(e._s(t.status))])],1),e.isSelf(t._id)?s("v-btn",{attrs:{small:"",round:"",disabled:""}},[e._v("\n            你\n            ")]):e.isFriend(t._id)?s("v-btn",{attrs:{small:"",round:"",disabled:""}},[e._v("\n            好友\n            ")]):e.hasSentRequest(t._id)?s("v-btn",{attrs:{small:"",round:"",disabled:""}},[e._v("\n            已发送请求\n            ")]):s("v-btn",{staticClass:"green lighten-2 white--text uploadBtn",attrs:{small:"",round:"",ripple:"",flat:"",loading:e.isLoading(t._id,e.loading)},on:{click:function(s){return e.addFriend(t._id)}}},[s("v-icon",{attrs:{dark:""}},[e._v("person_add")])],1)],1),n!=e.results.length-1?s("v-divider",{key:t.username,attrs:{inset:""}}):e._e()]})],2)],1)},as=[],os=s("b012"),rs=s.n(os),cs={name:"friendlist",components:{TabContainer:At},data:function(){return{loading:null,selectedUserId:"",results:[],keyword:"",sentRequest:[]}},computed:Object(c["a"])({},Object(i["e"])("user",["user"]),Object(i["c"])("user",{friends:"friendsList"})),methods:{isFriend:function(e){for(var t=!1,s=0;s<this.friends.length;s++)e===this.friends[s]._id&&(t=!0);return t},isSelf:function(e){var t=!1;return this.user._id===e&&(t=!0),t},isLoading:function(e,t){if(this.selectedUserId===e)return t},searchFriend:rs()(function(){var e=this;this.keyword?_(this.keyword).then(function(t){e.results=t.results}).catch(function(e){console.log(e)}):this.results=[]},200),addFriend:function(e){this.loading=!0,this.selectedUserId=e,this.$socket.emit("friendRequest",{uid:this.user._id,fid:e})},hasSentRequest:function(e){var t=!1;return-1!==this.sentRequest.indexOf(e)&&(t=!0),t}},sockets:{sentFriendRequest:function(e){this.loading=!1,this.sentRequest.push(e)}}},ls=cs,us=(s("f469"),Object(je["a"])(ls,is,as,!1,null,"0c2b4056",null)),ds=us.exports,hs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-layout",{staticClass:"profile"},[s("v-flex",{attrs:{xs12:""}},[s("v-container",{staticClass:"pl-0 pr-0 pb-0 profile-container"},[s("v-layout",[s("v-flex",{attrs:{"text-xs-center":""}},[s("div",{staticClass:"avatarDiv"},[s("v-avatar",{attrs:{size:"20vmin"}},[s("img",{attrs:{src:e.friend.avatar,alt:"avatar"}})])],1),s("div",{staticClass:"username"},[e._v("\n                            "+e._s(e.friend.username)+"\n                            "),"男"===e.friend.gender?s("v-icon",{staticClass:"blue--text"},[e._v("mdi-gender-male")]):s("v-icon",{staticClass:"pink--text"},[e._v("mdi-gender-female")])],1)])],1),s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs10:"","offset-xs1":""}},[s("div",{staticClass:"user-info mt-3"},[s("div",[s("v-icon",{staticClass:"grey--text text--lighten-1"},[e._v("mdi-email")]),s("span",[e._v(e._s(e.friend.email))])],1),s("div",[s("v-icon",{staticClass:"grey--text text--lighten-1"},[e._v("mdi-cellphone-iphone")]),s("span",[e._v(e._s(e.friend.mobile))])],1),s("div",[s("v-icon",{staticClass:"grey--text text--lighten-1"},[e._v("mdi-lead-pencil")]),s("div",{class:{"animated tada":e.isHover},attrs:{id:"status"},on:{mouseover:function(t){e.isHover=!0},mouseleave:function(t){e.isHover=!1}}},[e._v(e._s(e.friend.status?e.friend.status:"他有点懒，什么也没写..."))])],1)])])],1)],1)],1)],1)},ms=[],vs={name:"friendprofile",data:function(){return{isHover:!1}},computed:Object(c["a"])({},Object(i["c"])("chatRoom",{friend:"currentFriend"}))},fs=vs,gs=(s("5bdc"),Object(je["a"])(fs,hs,ms,!1,null,"45b41e90",null)),ps=gs.exports,bs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("tab-container",[s("v-list",{staticClass:"list",attrs:{"two-line":""}},[s("v-subheader",{staticClass:"grey--text text--lighten-4"},[e._v("Friend Requests")]),e.incomingFriendRequestsList?s("div",[e._l(e.incomingFriendRequestsList,function(t,n){return[s("v-list-tile",{key:n,attrs:{avatar:""}},[s("v-list-tile-avatar",[s("img",{attrs:{src:t.avatar}})]),s("v-list-tile-content",{staticClass:"grey--text text--lighten-4"},[s("v-list-tile-title",{domProps:{innerHTML:e._s(t.username)}}),s("v-list-tile-sub-title",[e._v("请求加你为好友")])],1),s("v-list-tile-action",[s("span",[s("v-btn",{staticClass:"green--text grey darken-2 mr-3",attrs:{icon:""},on:{click:function(s){return e.agree(t,n)}}},[s("v-icon",[e._v("mdi-check")])],1),s("v-btn",{staticClass:"red--text grey darken-2",attrs:{icon:""},on:{click:function(s){return e.refuse(t,n)}}},[s("v-icon",[e._v("mdi-close")])],1)],1)])],1),n!=e.incomingFriendRequestsList.length-1?s("v-divider",{key:n,attrs:{inset:""}}):e._e()]})],2):e._e()],1)],1)},Cs=[],_s={name:"friendrequest",components:{TabContainer:At},computed:Object(c["a"])({},Object(i["e"])("user",["user"]),Object(i["c"])("user",["incomingFriendRequestsList"])),methods:Object(c["a"])({agree:function(e,t){this.removeRequest(t),this.$socket.emit("agreeAddFriend",{uid:this.user._id,fid:e._id})},refuse:function(e,t){this.removeRequest(t),this.$socket.emit("refuseAddFriend",{uid:this.user._id,fid:e._id})}},Object(i["d"])("user",{updateRequest:E,removeRequest:j})),sockets:{incomingFriendRequest:function(e){this.updateRequest({friendRequest:e.incomingFriendRequests})},addFriend:function(e){this.updateRequest({friendRequest:e.updatedIncomingFriendRequestList.incomingFriendRequests})},refuseAddFriend:function(e){this.updateRequest({friendRequest:e.updatedIncomingFriendRequestList.incomingFriendRequests})}}},xs=_s,Rs=(s("2f86"),Object(je["a"])(xs,bs,Cs,!1,null,"1b66844b",null)),ws=Rs.exports,ys=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-card",{staticClass:"video-card"},[s("div",{staticClass:"background",style:{backgroundImage:"url("+e.target.avatar+")"}}),s("div",{staticClass:"target"},[s("v-avatar",{attrs:{size:"15vmin"}},[s("img",{attrs:{src:e.target.avatar,alt:"avatar"},on:{click:e.onAgree}})]),s("div",{staticClass:"username grey--text text--lighten-4"},[e._v("\n            "+e._s(e.target.username)+"\n            "),"男"===e.target.gender?s("v-icon",{staticClass:"blue--text"},[e._v("mdi-gender-male")]):s("v-icon",{staticClass:"pink--text"},[e._v("mdi-gender-female")])],1)],1),s("div",{staticClass:"buttons"},[s("div",{staticClass:"btn call-btn"},[s("v-icon",[e._v("call")])],1),s("div",{staticClass:"btn end-btn",on:{click:e.hangup}},[s("v-icon",[e._v("call_end")])],1)]),s("video",{ref:"video"})])},ks=[],Os={name:"VideoCard",props:{request:{type:Object,default:function(){return{}}},srcObject:{type:MediaStream,default:null}},data:function(){return{videoConnection:null}},computed:{sender:function(){return this.request.sender||{}},receiver:function(){return this.request.receiver||{}},target:function(){return this.sender?this.sender:this.receiver}},watch:{srcObject:function(e){var t=this;this.$refs.video.srcObject=e,this.$refs.video.onloadedmetadata=function(){t.$refs.video.play()}}},mounted:function(){document.body.appendChild(this.$el)},methods:{hangup:function(){this.srcObject&&this.srcObject.getTracks().forEach(function(e){return e.stop()}),Re.$emit("hangup")}}},js=Os,Es=(s("64db"),Object(je["a"])(js,ys,ks,!1,null,"1fcd66ef",null)),Ss=Es.exports,Ts={name:"chatroom",components:{Profile:kt,ChatBox:Wt,FriendsList:ns,SearchFriend:ds,FriendProfile:ps,ChatRoomList:Ft,FriendRequest:ws,VideoCard:Ss},data:function(){return{timeout:5e3,showHint:!1,newFriendRequestHint:"",messageIcon:"mdi mdi-message-text",currentTabIndex:0,friendTimer:0,showVideoCard:!1,videoRequest:{},videoResponse:{},videoSrcObject:null}},computed:Object(c["a"])({},Object(i["e"])("user",["user"]),Object(i["e"])("chatRoom",{chatRooms:"chatRooms",selectedChatRoom:"selectedChatRoom",isActive:"isChatting"})),created:function(){Re.$on("hangup",this.handleHangup)},methods:Object(c["a"])({handleTabChange:function(e){this.currentTabIndex=e,"mdi mdi-forum"===this.messageIcon&&1===e&&(this.messageIcon="mdi mdi-message-text")},updateFriendsInfo:function(){var e=this;this.friendTimer=setInterval(function(){e.getUpdatedFriends()},12e5)},logout:function(){var e=this;b().then(function(t){t.isLogout&&(pe("awesome"),e.resetUser(),e.resetChatRooms(),clearInterval(e.friendTimer),e.$router.push("/login"))})},handleVideo:function(e){this.videoSrcObject=e,this.showVideoCard=!0},handleVideoCall:function(e){this.videoRequest=e,this.showVideoCard=!0},handleHangup:function(){this.videoSrcObject=null,this.showVideoCard=!1}},Object(i["b"])("user",["getUpdatedFriends"]),Object(i["d"])("user",{resetUser:S}),Object(i["d"])("chatRoom",{resetChatRooms:B})),sockets:{incomingFriendRequest:function(e){this.newFriendRequestHint="收到".concat(e.incomingFriendRequests.length,"个好友请求"),this.showHint=!0},message:function(e){1!==this.currentTabIndex&&(this.selectedChatRoom.recipient&&this.selectedChatRoom.recipient._id===e.sender||(this.messageIcon="mdi mdi-forum"))},messageInNewChatRoom:function(){1!==this.currentTabIndex&&(this.messageIcon="mdi mdi-forum")}},mounted:function(){this.user._id&&this.updateFriendsInfo()}},qs=Ts,As=(s("60db"),Object(je["a"])(qs,bt,Ct,!1,null,null,null)),Ms=As.exports;n["default"].use(Le["a"]);var Is=new Le["a"]({mode:"history",routes:[{path:"/",component:at,meta:{keepAlive:!0}},{path:"/login",component:pt,meta:{keepAlive:!1}},{path:"/chatroom",component:Ms,meta:{keepAlive:!1},beforeEnter:function(e,t,s){ge("awesome")?s():s("/login")}},{path:"*",redirect:"/"}]}),Ns=s("5132"),Fs=s.n(Ns),$s=s("4d48"),Ls=s.n($s),Hs=s("123d"),Vs=s.n(Hs);s("4bf4"),s("0f20");n["default"].config.productionTip=!1,n["default"].use(i["a"]),n["default"].use(ue.a,{iconfont:"mdi"}),n["default"].use(Ls.a),n["default"].use(Vs.a),n["default"].use(new Fs.a({connection:"http://localhost:3000/"})),n["default"].use(de["b"],{locale:"zh_CN"}),new n["default"]({router:Is,store:ce,render:function(e){return e($e)}}).$mount("#app")},5896:function(e,t,s){},"5bdc":function(e,t,s){"use strict";var n=s("b835"),i=s.n(n);i.a},"60db":function(e,t,s){"use strict";var n=s("314d"),i=s.n(n);i.a},"64db":function(e,t,s){"use strict";var n=s("5896"),i=s.n(n);i.a},7175:function(e,t,s){},7627:function(e,t,s){},"77e6":function(e,t,s){"use strict";var n=s("bac1"),i=s.n(n);i.a},"7e91":function(e,t,s){},8330:function(e,t,s){},9917:function(e,t,s){"use strict";var n=s("010f"),i=s.n(n);i.a},a4d6:function(e,t,s){},a900:function(e,t,s){"use strict";var n=s("33cd"),i=s.n(n);i.a},b835:function(e,t,s){},bac1:function(e,t,s){},c3a0:function(e,t,s){},cf05:function(e,t,s){e.exports=s.p+"img/logo.3a9a9a92.png"},d56c:function(e,t,s){},e569:function(e,t,s){"use strict";var n=s("7627"),i=s.n(n);i.a},e9bf:function(e,t,s){"use strict";var n=s("c3a0"),i=s.n(n);i.a},ef68:function(e,t,s){"use strict";var n=s("5002"),i=s.n(n);i.a},f469:function(e,t,s){"use strict";var n=s("d56c"),i=s.n(n);i.a}});
//# sourceMappingURL=app.a8e42cb3.js.map